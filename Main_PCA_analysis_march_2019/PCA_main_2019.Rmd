---
title: "PCA_analysis"
author: "Kevin Healy"
date: "19 June 2017"
output:
  pdf_document: default
  html_document: default
---

First we load the required packages including the mulTree package which will allow us to read back in the relavent information from the MCMCglmm models we ran previously. We will also require the `paran` package for the PCA test, `caper`, `phytools` and `MCMCglmm` to handle the phylogeny objects and related functions and `SIBER` and `ggplot2` to creat the ellipses and plot the overlaps. As in previous scripts we will also use some costume functions.

```{r source functions}

library(caper)
library(phytools)
library(MCMCglmm)
library(mulTree)
library(paran)
library(SIBER)
library(ggplot2)

source("Demography_functions.R")
```

Now we upload the previous data including both the life history metrics we calulated and also the body size, IUCN and other data.
```{r  data}

pop_data <- read.csv("axis_analysis_data.csv", 
                         sep = ",", header = T)


```

Next we upload the matching distribution of phylogenies calculated from the previous Phylogeny_construction and Pop_metric_calulation scripts.

```{r phylogeny}

axis_trees <- read.tree("axis_analysis_phylo.tre")

```



Log10 the non index based metrics
```{r log data }

log_list <- c("life_time_La",
              "mean_repo_rate_stable_state",
              "mean_repo_rate",
              "gen_time",
              "M_rep_lif_exp",
              "gini",
              "surv_sd",
              "mass_g",
              "mxlxsd",
              "matrix_size")

pop_data_log <- pop_data

pop_data_log[,log_list] <- sapply(pop_data[,log_list], function(x) log10(x))

```



##Read back in the the MCMCglmm model outputs

For each of the life history metrics we read back in the information we need from the 100 MCMCglmm models we ran. We will then calculate the residuals form these which will be then used for the PCA analysis. We will also look at the random terms of phylogentic effect, population level variance (species) and the residual term.

#Age at first reproduction

```{r La readback run}
La_models <- read.mulTree("la_run")
summary(La_models)
```

Now we calculate the proportion of variance between phylogenetic, population and residual variance.

```{r La var, include=TRUE, warning = FALSE}
la_var <- read.mulTree("la_run", extract = "VCV")

#phylogenetic signal
la_phlyo <- list()
#population level variation
la_spec <- list()
#residual
la_unit <- list()

#extrace the random terms from across the models
for(i in 1:length(names(la_var))){

  la_phlyo[[i]] <-  la_var[[1]][,1] 
  la_spec[[i]] <-  la_var[[1]][,2] 
  la_unit[[i]] <-  la_var[[1]][,3] 
  }

la_phlyo <- unlist(la_phlyo)
la_spec <- unlist(la_spec)
la_unit <- unlist(la_unit)

la_prop_phlyo <- la_phlyo/(la_phlyo + la_spec + la_unit)
la_prop_spec  <- la_spec/(la_phlyo + la_spec + la_unit)
la_prop_residuals  <- la_unit/(la_phlyo + la_spec + la_unit)

hdr(la_prop_phlyo)$mode
hdr(la_prop_spec)$mode
hdr(la_prop_residuals)$mode

```


Next calculate the residuals from the allometric model for Age at first reproduction.

```{r La residuals}

La_resids <- mul_resids(mul_output = La_models, 
                        mul_data = pop_multree, 
                        Y_data_col = c("life_time_La")
 )

```


#Mean Reporductive Rate

```{r mean_repo_rate readback run}
repo_models <- read.mulTree("mean_repo_rate_run")
summary(repo_models)
```


Now we calculate the proportion of variance between phylogenetic, population and residual variance.

```{r mean_repo_rate var}
repo_var <- read.mulTree("mean_repo_rate_run", extract = "VCV")

repo_phlyo <- list()
repo_spec <- list()
repo_unit <- list()

for(i in 1:length(names(repo_var))){

  repo_phlyo[[i]] <-  repo_var[[1]][,1] 
  repo_spec[[i]] <-  repo_var[[1]][,2] 
  repo_unit[[i]] <-  repo_var[[1]][,3] 
  }

repo_phlyo <- unlist(repo_phlyo)
repo_spec <- unlist(repo_spec)
repo_unit <- unlist(repo_unit)

repo_prop_phlyo <- repo_phlyo/(repo_phlyo + repo_spec + repo_unit)
repo_prop_spec  <- repo_spec/(repo_phlyo + repo_spec + repo_unit)
repo_prop_residuals  <- repo_unit/(repo_phlyo + repo_spec + repo_unit)

hdr(repo_prop_phlyo)$mode
hdr(repo_prop_spec)$mode
hdr(repo_prop_residuals)$mode
```


Next calculate the residuals from the allometric model for mean reporductive rate.

```{r mean_repo_rate residuals}

repo_resids <- mul_resids(mul_output = repo_models, 
                        mul_data = pop_multree, 
                        Y_data_col = c("mean_repo_rate_stable_state")
 )

```


#Mean Reporductive Rate not at the stabel state distribution


```{r mean_repo_rate_nst readback run}
repo_nst_models <- read.mulTree("mean_repo_rate_nst_run")
summary(repo_nst_models)
```


Now we calculate the proportion of variance between phylogenetic, population and residual variance.

```{r mean_repo_rate_nst var}
repo_nst_var <- read.mulTree("mean_repo_rate_nst_run", extract = "VCV")

repo_nst_phlyo <- list()
repo_nst_spec <- list()
repo_nst_unit <- list()

for(i in 1:length(names(repo_nst_var))){

  repo_nst_phlyo[[i]] <-  repo_nst_var[[1]][,1] 
  repo_nst_spec[[i]] <-  repo_nst_var[[1]][,2] 
  repo_nst_unit[[i]] <-  repo_nst_var[[1]][,3] 
  }

repo_nst_phlyo <- unlist(repo_nst_phlyo)
repo_nst_spec <- unlist(repo_nst_spec)
repo_nst_unit <- unlist(repo_nst_unit)

repo_nst_prop_phlyo <- repo_nst_phlyo/(repo_nst_phlyo + repo_nst_spec + repo_nst_unit)
repo_nst_prop_spec  <- repo_nst_spec/(repo_nst_phlyo + repo_nst_spec + repo_nst_unit)
repo_nst_prop_residuals  <- repo_nst_unit/(repo_nst_phlyo + repo_nst_spec + repo_nst_unit)

hdr(repo_nst_prop_phlyo)$mode
hdr(repo_nst_prop_spec)$mode
hdr(repo_nst_prop_residuals)$mode

```


Next calculate the residuals from the allometric model for mean reporductive rate not at the stable state.

```{r mean_repo_rate_nst residuals}

repo_nst_resids <- mul_resids(mul_output = repo_nst_models, 
                        mul_data = pop_multree, 
                        Y_data_col = c("mean_repo_rate")
 )

```


#Standard deviation of mxlx


```{r mxlxsd readback run}
mxlxsd_models <- read.mulTree("mxlxsd_logged_10_run")
summary(mxlxsd_models)
```

Now we calculate the proportion of variance between phylogenetic, population and residual variance.

```{r mxlxsd var}
mxlxsd_var <- read.mulTree("mxlxsd_logged_10_run", extract = "VCV")

mxlxsd_phlyo <- list()
mxlxsd_spec <- list()
mxlxsd_unit <- list()

for(i in 1:length(names(mxlxsd_var))){

  mxlxsd_phlyo[[i]] <-  mxlxsd_var[[1]][,1] 
  mxlxsd_spec[[i]] <-  mxlxsd_var[[1]][,2] 
  mxlxsd_unit[[i]] <-  mxlxsd_var[[1]][,3] 
  }

mxlxsd_phlyo <- unlist(mxlxsd_phlyo)
mxlxsd_spec <- unlist(mxlxsd_spec)
mxlxsd_unit <- unlist(mxlxsd_unit)

mxlxsd_prop_phlyo <- mxlxsd_phlyo/(mxlxsd_phlyo + mxlxsd_spec + mxlxsd_unit)
mxlxsd_prop_spec  <- mxlxsd_spec/(mxlxsd_phlyo + mxlxsd_spec + mxlxsd_unit)
mxlxsd_prop_residual  <- mxlxsd_unit/(mxlxsd_phlyo + mxlxsd_spec + mxlxsd_unit)

hdr(mxlxsd_prop_phlyo)$mode
hdr(mxlxsd_prop_spec)$mode
hdr(mxlxsd_prop_residual)$mode

```

Next calculate the residuals from the allometric model for mxlxsd

```{r mxlxsd residuals}

mxlxsd_resids <- mul_resids(mul_output = mxlxsd_models, 
                        mul_data = pop_multree, 
                        Y_data_col = c("mxlxsd")
 )

```



#Generation Time

```{r gen readback run}
gen_time_models <- read.mulTree("gen_time_run")
summary(gen_time_models)
```

Now we calculate the proportion of variance between phylogenetic, population and residual variance.

```{r gen_time_run var}
gen_time_var <- read.mulTree("gen_time_run", extract = "VCV")

gen_time_phlyo <- list()
gen_time_spec <- list()
gen_time_unit <- list()

for(i in 1:length(names(gen_time_var))){

  gen_time_phlyo[[i]] <-  gen_time_var[[1]][,1] 
  gen_time_spec[[i]] <-  gen_time_var[[1]][,2] 
  gen_time_unit[[i]] <-  gen_time_var[[1]][,3] 
  }

gen_time_phlyo <- unlist(gen_time_phlyo)
gen_time_spec <- unlist(gen_time_spec)
gen_time_unit <- unlist(gen_time_unit)

gen_time_prop_phlyo <- gen_time_phlyo/(gen_time_phlyo + gen_time_spec + gen_time_unit)
gen_time_prop_spec  <- gen_time_spec/(gen_time_phlyo + gen_time_spec + gen_time_unit)
gen_time_prop_residual  <- gen_time_unit/(gen_time_phlyo + gen_time_spec + gen_time_unit)

hdr(gen_time_prop_phlyo)$mode
hdr(gen_time_prop_spec)$mode
hdr(gen_time_prop_residual)$mode

```

Next calculate the residuals from the allometric model for generation time

```{r gen_time_run residuals}

gen_time_resids <- mul_resids(mul_output = gen_time_models, 
                        mul_data = pop_multree, 
                        Y_data_col = c("gen_time")
 )

```


#Life expectancy conditional on reaching sexual maturity

```{r M_rep_lif_exp readback run}
M_rep_lif_exp_models <- read.mulTree("M_rep_lif_exp_run")
summary(M_rep_lif_exp_models)
```

Now we calculate the proportion of variance between phylogenetic, population and residual variance.

```{r M_rep_lif_exp var}
M_rep_lif_exp_var <- read.mulTree("M_rep_lif_exp_run", extract = "VCV")

M_rep_lif_exp_phlyo <- list()
M_rep_lif_exp_spec <- list()
M_rep_lif_exp_unit <- list()

for(i in 1:length(names(M_rep_lif_exp_var))){

  M_rep_lif_exp_phlyo[[i]] <-  M_rep_lif_exp_var[[1]][,1] 
  M_rep_lif_exp_spec[[i]] <-  M_rep_lif_exp_var[[1]][,2] 
  M_rep_lif_exp_unit[[i]] <-  M_rep_lif_exp_var[[1]][,3] 
  }

M_rep_lif_exp_phlyo <- unlist(M_rep_lif_exp_phlyo)
M_rep_lif_exp_spec <- unlist(M_rep_lif_exp_spec)
M_rep_lif_exp_unit <- unlist(M_rep_lif_exp_unit)

M_rep_lif_exp_prop_phlyo <- M_rep_lif_exp_phlyo/(M_rep_lif_exp_phlyo + M_rep_lif_exp_spec + M_rep_lif_exp_unit)
M_rep_lif_exp_prop_spec  <- M_rep_lif_exp_spec/(M_rep_lif_exp_phlyo + M_rep_lif_exp_spec + M_rep_lif_exp_unit)
M_rep_lif_exp_prop_residuals  <- M_rep_lif_exp_unit/(M_rep_lif_exp_phlyo + M_rep_lif_exp_spec + M_rep_lif_exp_unit)

hdr(M_rep_lif_exp_prop_phlyo)$mode
hdr(M_rep_lif_exp_prop_spec)$mode
hdr(M_rep_lif_exp_prop_residuals)$mode

```

Next calculate the residuals from the allometric model for life expectancy conditional on reaching sexual maturity

```{r M_rep_lif_exp residuals}

M_rep_lif_exp_resids <- mul_resids(mul_output = M_rep_lif_exp_models, 
                        mul_data = pop_multree, 
                        Y_data_col = c("M_rep_lif_exp")
 )

```


#Gini index

```{r gini readback run}
gini_models <- read.mulTree("gini_logged_run")

summary(gini_models)

```

Now we calculate the proportion of variance between phylogenetic, population and residual variance.

```{r gini read in}
gini_var <- read.mulTree("gini_logged_run", extract = "VCV")

gini_phlyo <- list()
gini_spec <- list()
gini_unit <- list()

for(i in 1:length(names(gini_var))){

  gini_phlyo[[i]] <-  gini_var[[1]][,1] 
  gini_spec[[i]] <-  gini_var[[1]][,2] 
  gini_unit[[i]] <-  gini_var[[1]][,3] 
  }

gini_phlyo <- unlist(gini_phlyo)
gini_spec <- unlist(gini_spec)
gini_unit <- unlist(gini_unit)

gini_prop_phlyo <- gini_phlyo/(gini_phlyo + gini_spec + gini_unit)
gini_prop_spec  <- gini_spec/(gini_phlyo + gini_spec + gini_unit)
gini_prop_residuals  <- gini_unit/(gini_phlyo + gini_spec + gini_unit)

hdr(gini_prop_phlyo)$mode
hdr(gini_prop_spec)$mode
hdr(gini_prop_residuals)$mode

```

Next calculate the residuals from the allometric model for the gini index

```{r gini residuals}

gini_resids <- mul_resids(mul_output = gini_models, 
                        mul_data = pop_multree, 
                        Y_data_col = c("gini")
 )

```



#Standard deviation of mortality rates


```{r surv readback run}
surv_sd_models <- read.mulTree("surv_sd_logged_run")

summary(surv_sd_models)

```

Now we calculate the proportion of variance between phylogenetic, population and residual variance.

```{r surv read in}
surv_sd_var <- read.mulTree("surv_sd_logged_run", extract = "VCV")

surv_sd_phlyo <- list()
surv_sd_spec <- list()
surv_sd_unit <- list()

for(i in 1:length(names(surv_sd_var))){

  surv_sd_phlyo[[i]] <-  surv_sd_var[[1]][,1] 
  surv_sd_spec[[i]] <-  surv_sd_var[[1]][,2] 
  surv_sd_unit[[i]] <-  surv_sd_var[[1]][,3] 
  }

surv_sd_phlyo <- unlist(surv_sd_phlyo)
surv_sd_spec <- unlist(surv_sd_spec)
surv_sd_unit <- unlist(surv_sd_unit)

surv_sd_prop_phlyo <- surv_sd_phlyo/(surv_sd_phlyo + surv_sd_spec + surv_sd_unit)
surv_sd_prop_spec  <- surv_sd_spec/(surv_sd_phlyo + surv_sd_spec + surv_sd_unit)
surv_sd_prop_residuals  <- surv_sd_unit/(surv_sd_phlyo + surv_sd_spec + surv_sd_unit)

hdr(surv_sd_prop_phlyo)$mode
hdr(surv_sd_prop_spec)$mode
hdr(surv_sd_prop_residuals)$mode

```

Next calculate the residuals from the allometric model for the standard deviation

```{r surv residuals}

surv_sd_resids <- mul_resids(mul_output = surv_sd_models, 
                        mul_data = pop_multree, 
                        Y_data_col = c("surv_sd")
 )

```



Using the outputs for the life history metrics lets plot them out.

```{r allometry for supp table}

par(mfrow=c(2,3))

##la
plot(pop_multree$data$life_time_La ~ pop_multree$data$mass_g, pch = 16,
     xlab = expression('log'[10]*" mass"),
     ylab = "Age at sexual maturity")
abline(summary(La_models)[1],summary(La_models)[2])

#M_rep_lif_exp
plot(pop_multree$data$M_rep_lif_exp ~ pop_multree$data$mass_g, pch = 16,
          xlab = expression('log'[10]*" mass"),
          ylab = "Life expectancy post maturity")
abline(summary(M_rep_lif_exp_models)[1],summary(M_rep_lif_exp_models)[2])

#generation time
plot(pop_multree$data$gen_time ~ pop_multree$data$mass_g, pch = 16,
          xlab = expression('log'[10]*" mass"),
          ylab = "Generation time")
abline(summary(gen_time_models)[1],summary(gen_time_models)[2])


##mean repo rate
plot(pop_multree$data$mean_repo_rate_stable_state ~ pop_multree$data$mass_g, pch = 16,
          xlab = expression('log'[10]*" mass"),
          ylab = "Mean reproductive rate")
abline(summary(repo_models)[1],summary(repo_models)[2])



#Gini
plot(pop_multree$data$gini ~ pop_multree$data$mass_g, pch = 16,
          xlab = expression('log'[10]*" mass"),
          ylab = "Spread of reproduction")
abline(summary(gini_models)[1],summary(gini_models)[2])

#SD of survival
plot(pop_multree$data$surv_sd ~ pop_multree$data$mass_g, pch = 16, 
     xlab = expression('log'[10]*" mass"),
     ylab = "Distribution of survival")
abline(summary(surv_sd_models)[1],summary(surv_sd_models)[2])

```



Lets also plot out the model slope cooficents into a table.
```{r plots for allometry table}

##Allometric scaling
#pdf("scaling_bar_plots.pdf")
scaling_list <- list( La_B = La_models$mass_g,
                      Sur_B = M_rep_lif_exp_models$mass_g,
                      T_B = gen_time_models$mass_g, 
                      Repo_B = repo_models$mass_g,
                      life_shape_B = surv_sd_models$mass_g,
                      gini_B = gini_models$mass_g
                      )
MultiDisPlot(scaling_list)
#dev.off()


```

Lets also plot out the phylogentic signals into a table.
```{r plots for phylo var table}

#pdf("phy_var_plots.pdf")
phy_var_list <- list( La_B = la_prop_phlyo,
                      Sur_B = M_rep_lif_exp_prop_phlyo,
                      T_B = gen_time_prop_phlyo, 
                      Repo_B = repo_prop_phlyo,
                      life_shape_B = surv_sd_prop_phlyo,
                      gini_B = gini_prop_phlyo
                      )
MultiDisPlot(phy_var_list)
#dev.off()


```

Lets also plot out the population level variances into a table.
```{r plots for species var table}

#pdf("species_var_plots.pdf")
species_var_list <- list(
                      La_B = la_prop_spec,
                      Sur_B = M_rep_lif_exp_prop_spec,
                      T_B = gen_time_prop_spec, 
                      Repo_B = repo_prop_spec,
                      life_shape_B = surv_sd_prop_spec,
                      gini_B = gini_prop_spec
                      )
MultiDisPlot(species_var_list, xlim = c(0,1))
#dev.off()


```




Now lets create a dataset of these residuals for each PCA analysis. This includes, the main analysis, the analysis using mean reporductive rate with the population not at its stable state distribution, the analysis using the standard deviation of mxlx curve as a measure of the Gini index and the analysis with generation time removed.

```{r MCMC residual data}

#Main PCA dataset
predicted_data <- data.frame(
                        SD_mort = surv_sd_resids,
                        La_r = La_resids,
                        gen_r = gen_time_resids,
                        M_repo = repo_resids,
                        M_suv = M_rep_lif_exp_resids,
                        gini_r = gini_resids
                        )

#PCA dataset using mean reporductive rate with the population not at its stable state distribution.
predicted_data_M_repo_nst <- data.frame(
                         SD_mort = surv_sd_resids,
                        La_r = La_resids,
                        gen_r = gen_time_resids,
                        M_repo_nst = repo_nst_resids,
                        M_suv = M_rep_lif_exp_resids,
                        gini_r = gini_resids
                        )

#PCA dataset using the standard deviation of the mxlx curve
predicted_data_mxlxsd <- data.frame(
                        SD_mort = surv_sd_resids,
                        La_r = La_resids,
                        gen_r = gen_time_resids,
                        M_repo = repo_resids,
                        M_suv = M_rep_lif_exp_resids,
                        mxlxsd = mxlxsd_resids
                        )
#PCA dataset without generation time.
predicted_data_noT <- data.frame(
                         SD_mort = surv_sd_resids,
                        La_r = La_resids,
                        M_repo = repo_resids,
                        M_suv = M_rep_lif_exp_resids,
                        gini = gini_resids
                        )

```

#PCA

Now we run a PCA for each of the datasets of residuals from the life history allometric models.

```{r MCMC PCA}
pca_res <- prcomp(predicted_data)

pca_nst <- prcomp(predicted_data_M_repo_nst)

pca_mxlxsd <- prcomp(predicted_data_mxlxsd)

pca_noT <- prcomp(predicted_data_noT)

```



Next we use Horn's Parallel Analysis of Principal Components to test for the number of axis to retain.

```{r testing the PCA plots}
horn_res <- paran(predicted_data)
horn_nst <- paran(predicted_data_M_repo_nst)
horn_mxlx <- paran(predicted_data_mxlxsd)
horn_noT <- paran(predicted_data_noT)

```


PLOTS 

Lets make some beter plots. First we can flip the PCA axis so that it reads with increases towards slow lifestyles on the right and increasing towards tye 1 survorship curves upwards

```{r flipping rotation}
results <- pca_res
results$rotation[,"PC1"] <- -results$rotation[,"PC1"]
results$x[,"PC1"] <- -results$x[,"PC1"]
results$rotation[,"PC2"] <- -results$rotation[,"PC2"]
results$x[,"PC2"] <- -results$x[,"PC2"]
```




Now lets make a nicer looking PCA graph

```{r set up the plot figure}

result <- results

loadings <- as.data.frame(result$rotation)
#loadings_nst <- as.data.frame(results_nst$rotation)

loadings[,"col"]=c("gray50",
                   "gray50",
                   "gray50",
                   "gray50",
                   "gray50",
                   "gray50"
                   )


loadings$LHT=rownames(loadings)


loadings$LHT=c("surv_sd",
               "La",
               "gen_time",
               "mean_repo_rate",
               "M_suv"
               ,"gini_r"
               )


loadings$LHTexpr <-  list(
                          expression(sigma),
                          expression("L"[alpha]), 
                          expression("T"),
                          expression(phi), 
                          expression(Rep["e"]),
                          expression("G")
                       )

arrowThickness=2.9
sizeArrowLetters=1
scalingArrows=2.5
scalingLetters=2.9

class_match <- vector()
species_match <- vector()
loads_taxa <- data.frame(results$x)


for(i in 1:length(loads_taxa[,1])){
  
   class_match[i] <- as.vector(pop_multree$data[i,"taxa_name"])
   species_match[i] <- as.vector(pop_multree$data[i,"species"])

   }


pca_data <- cbind(loads_taxa,class_match, species_match)



##rename some of the mode of life levels
PCA1 <- pca_data[,1]
PCA2 <- pca_data[,2]

mobility_PCA <- pop_multree$data$mobility
mobility_PCA <- as.vector(mobility_PCA)
mobility_PCA[mobility_PCA == "fw_benthic"] <- "benthic"
mobility_PCA[mobility_PCA == "m_benthic"] <- "benthic"
mobility_PCA[mobility_PCA == "fw_pelagic"] <- "pelagic"
mobility_PCA[mobility_PCA == "m_pelagic"] <- "pelagic"
mobility_PCA[mobility_PCA == "fw_river"] <- "benthic"

mobility_PCA <- factor(mobility_PCA, levels = c("sessile", "arboreal", "benthic", "volant",
                                          "semiaquatic", "terrestrial" ,"pelagic",  "semifossorial"))

pca_data$mobility_PCA <- mobility_PCA


PCA_moblist <- list(semifossorial = pca_data[pca_data$mobility_PCA == "semifossorial",1],
                     pelagic = pca_data[pca_data$mobility_PCA == "pelagic",1], 
                     terrestrial = pca_data[pca_data$mobility_PCA == "terrestrial",1],
                     semiaquatic = pca_data[pca_data$mobility_PCA == "semiaquatic",1],
                     volant = pca_data[pca_data$mobility_PCA == "volant",1],
                     benthic = pca_data[pca_data$mobility_PCA == "benthic",1],
                     arboreal = pca_data[pca_data$mobility_PCA == "arboreal",1],
                     sessile = pca_data[pca_data$mobility_PCA == "sessile",1]
                     )






mam_col <- rgb(0,136,170, max= 255)
bird_col <- rgb(255,153,85, max= 255)
rep_col <- rgb(147,172,147, max= 255)
fish_col <- rgb(135,205,222, max= 255)
sponge_col <- rgb(211,95,141, max= 255)
coral_col <- rgb(153,85,255, max= 255)
gast_col <- rgb(255,170,238, max= 255)
biv_col <- rgb(205,135,222, max= 255)
shark_col <- rgb(85,0,212, max= 255)

```




Now let do the actual plot

```{r PCA plot}

#pdf("Figure2_PCA.pdf")
split <- rbind(c(0.15,0.9, 0.4,0.98), c(0.15,0.9, 0.1, 0.4))
split.screen(split)
screen(1)
par(mar = c(0, 0, 0, 0))
plot(pca_data[,1], pca_data[,2], pch=16, cex = 0.1, col = "white", xlab= "PCA",
     ylab= "PCA 2")

points(pca_data[pca_data$class_match == "Mammalia",1], pca_data[pca_data$class_match == "Mammalia",2], pch=16, col = mam_col)

points(pca_data[pca_data$class_match == "Aves",1], pca_data[pca_data$class_match == "Aves",2], pch=16, col = bird_col)

points(pca_data[pca_data$class_match == "Reptilia",1], pca_data[pca_data$class_match == "Reptilia",2], pch=16, col = rep_col)

points(pca_data[pca_data$class_match == "Actinopterygii",1], pca_data[pca_data$class_match == "Actinopterygii",2], pch=16, col = fish_col)

points(pca_data[pca_data$class_match == "Gastropoda",1], pca_data[pca_data$class_match == "Gastropoda",2], pch=16, col = gast_col)

points(pca_data[pca_data$class_match == "Demospongiae",1], pca_data[pca_data$class_match == "Demospongiae",2], pch=16, col = sponge_col)

points(pca_data[pca_data$class_match == "Anthozoa",1], pca_data[pca_data$class_match == "Anthozoa",2], pch=16, col = coral_col)

points(pca_data[pca_data$class_match == "Bivalvia",1], pca_data[pca_data$class_match == "Bivalvia",2], pch=16,col = biv_col)

points(pca_data[pca_data$class_match == "Elasmobranchii",1], pca_data[pca_data$class_match == "Elasmobranchii",2], pch=16,col = shark_col)

###And lets add Humans
points(pca_data[pca_data$species_match == "Homo_sapiens",1], pca_data[pca_data$species_match == "Homo_sapiens",2], pch= 16, col = "white", cex = 0.7)

##and other points
points(pca_data[pca_data$species_match == "Elephas_maximus",1], pca_data[pca_data$species_match == "Elephas_maximus",2], pch= 16, col = "white", cex = 0.7)

points(pca_data[pca_data$species_match == "Fulmarus_glacialis",1], pca_data[pca_data$species_match == "Fulmarus_glacialis",2], pch= 16, col = "white", cex = 0.7)

points(pca_data[pca_data$species_match == "Tympanuchus_cupido",1], pca_data[pca_data$species_match == "Tympanuchus_cupido",2], pch= "T", col = "white")

points(pca_data[pca_data$species_match == "Gyps_coprotheres",1], pca_data[pca_data$species_match == "Gyps_coprotheres",2], pch= 16, col = "white", cex = 0.7)

points(pca_data[pca_data$species_match == "Crocodylus_johnsoni",1], pca_data[pca_data$species_match == "Crocodylus_johnsoni",2], pch= 16, col = "white", cex = 0.7)

points(pca_data[pca_data$species_match == "Urocitellus_armatus",1], pca_data[pca_data$species_match == "Urocitellus_armatus",2], pch= 16, col = "white", cex = 0.7)

points(pca_data[pca_data$species_match == "Paramuricea_clavata",1], pca_data[pca_data$species_match == "Paramuricea_clavata",2], pch= 16, col = "white", cex = 0.7)

points(pca_data[pca_data$species_match == "Oncorhynchus_tshawytscha",1], pca_data[pca_data$species_match == "Oncorhynchus_tshawytscha",2], pch= 16, col = "white", cex = 0.7)

points(pca_data[pca_data$species_match == "Mya_arenaria",1], pca_data[pca_data$species_match == "Mya_arenaria",2], pch= 16, col = "white", cex = 0.7)

points(pca_data[pca_data$species_match == "Clemmys_guttata",1], pca_data[pca_data$species_match == "Clemmys_guttata",2], pch= 16, col = "white", cex = 0.7)


arrows(x0=0,y0=0,x1=loadings[,1]*scalingArrows,y1=loadings[,2]*scalingArrows,col="black", lwd=2)
arrows(x0=0,y0=0,x1=loadings[,1]*scalingArrows,y1=loadings[,2]*scalingArrows,col=as.character(loadings$col), lwd=arrowThickness)

#arrows(x0=0,y0=0,x1=loadings[,1]*scalingArrows,y1=loadings[,2]*scalingArrows,col="black", lwd=arrowThickness*2)
#arrows(x0=0,y0=0,x1=loadings[,1]*scalingArrows,y1=loadings[,2]*scalingArrows,col=as.character(loadings$col), lwd=arrowThickness)

text(loadings[1,"PC1"]*scalingLetters-.0,loadings[1,"PC2"]*scalingLetters,loadings$LHTexpr[[1]],col = loadings$col[1], cex=sizeArrowLetters)
text(loadings[2,"PC1"]*scalingLetters-.0,loadings[2,"PC2"]*scalingLetters,loadings$LHTexpr[[2]],col = loadings$col[2], cex=sizeArrowLetters)
text(loadings[3,"PC1"]*scalingLetters+.0,loadings[3,"PC2"]*scalingLetters,loadings$LHTexpr[[3]],col = loadings$col[3], cex=sizeArrowLetters)
text(loadings[4,"PC1"]*scalingLetters-.0,loadings[4,"PC2"]*scalingLetters,loadings$LHTexpr[[4]],col = loadings$col[4], cex=sizeArrowLetters)
text(loadings[5,"PC1"]*scalingLetters-.0,loadings[5,"PC2"]*scalingLetters,loadings$LHTexpr[[5]],col = loadings$col[5], cex=sizeArrowLetters)
text(loadings[6,"PC1"]*scalingLetters+.0,loadings[6,"PC2"]*scalingLetters,loadings$LHTexpr[[6]],col = loadings$col[6], cex=sizeArrowLetters)
#text(loadings[7,"PC1"]*scalingLetters+.0,loadings[7,"PC2"]*scalingLetters,loadings$LHTexpr[[7]],col = loadings$col[7], cex=sizeArrowLetters)


screen(2)
par(mar = c(0, 0, 0, 0))

MultiDisPlot(PCA_moblist)
tick_lables <- names(PCA_moblist)
axis(2, 1:length(tick_lables), labels = tick_lables)

mob_match <- as.vector(mobility_PCA)

for(i in 1:(length(tick_lables))){
mob_match[mob_match == tick_lables[i]] <- i
}

mob_match <- as.numeric(mob_match)
pca_data$mob_match <- mob_match

points(pca_data[pca_data$class_match == "Mammalia","mob_match"] ~ pca_data[pca_data$class_match == "Mammalia",1], col = mam_col, pch = 20, cex = 0.5)

points(pca_data[pca_data$class_match == "Aves","mob_match"] ~ pca_data[pca_data$class_match == "Aves",1], col = bird_col, pch = 20, cex = 0.5)

points(pca_data[pca_data$class_match == "Reptilia","mob_match"] ~ pca_data[pca_data$class_match == "Reptilia",1], col = rep_col, pch = 20, cex = 0.5)

points(pca_data[pca_data$class_match == "Actinopterygii","mob_match"] ~ pca_data[pca_data$class_match == "Actinopterygii",1], col = fish_col, pch = 20, cex = 0.5)

points(pca_data[pca_data$class_match == "Gastropoda","mob_match"] ~ pca_data[pca_data$class_match == "Gastropoda",1], col = gast_col, pch = 20, cex = 0.5)

points(pca_data[pca_data$class_match == "Demospongiae","mob_match"] ~ pca_data[pca_data$class_match == "Demospongiae",1], col = sponge_col, pch = 20, cex = 0.5)

points(pca_data[pca_data$class_match == "Anthozoa","mob_match"] ~ pca_data[pca_data$class_match == "Anthozoa",1], col = coral_col, pch = 20, cex = 0.5)

points(pca_data[pca_data$class_match == "Bivalvia","mob_match"] ~ pca_data[pca_data$class_match == "Bivalvia",1], col = biv_col, pch = 20, cex = 0.5)

#close.screen(all.screens = TRUE)
#dev.off()

```




Now lets do some more plots


```{r ecology tests}


habitat_PCA <- pop_multree$data$habitat
habitat_PCA[habitat_PCA == "marine"] <- "marine"
habitat_PCA[habitat_PCA == "freshwater"] <- "marine"
habitat_PCA[habitat_PCA == "marine-freshwater"] <- "marine"
habitat_PCA <- factor(habitat_PCA, levels = c("terrestrial", "marine"))

pca_data$habitat_PCA <- habitat_PCA

pca_data$animal <- pca_data$species_match

##aqutic species

aquatic_res <- pca_data[pca_data$mobility_PCA == "sessile" | pca_data$mobility_PCA == "benthic"
                       | pca_data$mobility_PCA == "pelagic",]

aquatic_res$mobility_PCA <- factor(aquatic_res$mobility_PCA, levels = c("pelagic", "sessile", "benthic"))


prior<-list(R = list(V = 1/2, nu=0.002), 
            G = list(G1=list(V = 1/2,n = 1, alpha.mu=rep(0,1), alpha.V= diag(1)*10^3), 
                     G1=list(V = 1/2,n = 1, alpha.mu=rep(0,1), alpha.V= diag(1)*10^3)))


##needs to run longer
aquatic_pc1 <- MCMCglmm(PC1 ~ mobility_PCA,
                     data = aquatic_res,
                     random=~animal + species_match,
                     pedigree = axis_trees[[1]], 
                     prior = prior, 
                     nitt = c(1100000), burnin = 100000, thin = 500, verbose = F)
summary(aquatic_pc1)

aquatic_pc1_vcv_phylo <- aquatic_pc1$VCV[,1]
aquatic_pc1_vcv_spec <- aquatic_pc1$VCV[,2]
aquatic_pc1_vcv_units <- aquatic_pc1$VCV[,3]

aquatic_pc1_phylo <- aquatic_pc1_vcv_phylo/c(aquatic_pc1_vcv_phylo + aquatic_pc1_vcv_spec + aquatic_pc1_vcv_units)
aquatic_pc1_spec <- aquatic_pc1_vcv_spec/c(aquatic_pc1_vcv_phylo + aquatic_pc1_vcv_spec + aquatic_pc1_vcv_units)
aquatic_pc1_units <- aquatic_pc1_vcv_units/c(aquatic_pc1_vcv_phylo + aquatic_pc1_vcv_spec + aquatic_pc1_vcv_units)

hdr(aquatic_pc1_phylo)
hdr(aquatic_pc1_spec)
hdr(aquatic_pc1_units)



##terrestiral species

ter_res <- pca_data[pca_data$mobility_PCA == "terrestrial" | pca_data$mobility_PCA == "arboreal"
                       | pca_data$mobility_PCA == "volant" | pca_data$mobility_PCA == "semiaquatic" | pca_data$mobility_PCA == "semifossorial",]

ter_res$mobility_PCA <- factor(ter_res$mobility_PCA, levels = c("terrestrial", "arboreal", "volant", "semiaquatic","semifossorial"))


ter_pc1 <- MCMCglmm(PC1 ~ mobility_PCA,
                     data = ter_res,
                     random=~animal + species_match,
                     pedigree = axis_trees[[1]], 
                     prior = prior, 
                     nitt = c(1100000), burnin = 100000, thin = 500, verbose = F)
summary(ter_pc1)

ter_pc1_vcv_phylo <- ter_pc1$VCV[,1]
ter_pc1_vcv_spec <- ter_pc1$VCV[,2]
ter_pc1_vcv_units <- ter_pc1$VCV[,3]

ter_pc1_phylo <- ter_pc1_vcv_phylo/c(ter_pc1_vcv_phylo + ter_pc1_vcv_spec + ter_pc1_vcv_units)
ter_pc1_spec <- ter_pc1_vcv_spec/c(ter_pc1_vcv_phylo + ter_pc1_vcv_spec + ter_pc1_vcv_units)
ter_pc1_units <- ter_pc1_vcv_units/c(ter_pc1_vcv_phylo + ter_pc1_vcv_spec + ter_pc1_vcv_units)

hdr(ter_pc1_phylo)
hdr(ter_pc1_spec)
hdr(ter_pc1_units)


```



Metabolic rate analysis 
```{r metabolic rate plot}

pca_data$met_PCA <- met_PCA

pca_data$animal <- pca_data$species_match
pca_data$met_rate <- as.numeric(as.vector(pca_data$met_PCA))

pca_data_met <- na.omit(pca_data[,c("species_match","animal","PC1","class_match","met_rate")])




met_mod <- MCMCglmm(PC1 ~ log10(met_rate) ,
                     data = pca_data_met,
                     random=~animal + species_match,
                     pedigree = axis_trees[[1]], 
                     prior = prior, 
                     nitt = c(1100000), burnin = 100000, thin = 500, verbose = F)

summary(met_mod)

met_mod_phylo <- met_mod$VCV[,1]
met_mod_spec <- met_mod$VCV[,2]
met_mod_units <- met_mod$VCV[,3]

met_mod_phylo_H <- met_mod_phylo/c(met_mod_phylo + met_mod_spec + met_mod_units)
met_mod_spec_H <- met_mod_spec/c(met_mod_phylo + met_mod_spec + met_mod_units)
met_mod_units_H <- met_mod_units/c(met_mod_phylo + met_mod_spec + met_mod_units)

hdr(met_mod_phylo_H)
hdr(met_mod_spec_H)
hdr(met_mod_units_H)



plot(log10(pca_data_met$met_rate), pca_data_met$PC1, pch = 16, col = "white", cex = 0.1)

points(log10(pca_data_met[pca_data_met$class_match == "Mammalia","met_rate"]), pca_data_met[pca_data_met$class_match == "Mammalia","PC1"], col = mam_col, pch = 20, cex = 0.8)

points(log10(pca_data_met[pca_data_met$class_match == "Aves","met_rate"]), pca_data_met[pca_data_met$class_match == "Aves","PC1"], col = bird_col, pch = 20, cex = 0.8)

points(log10(pca_data_met[pca_data_met$class_match == "Reptilia","met_rate"]), pca_data_met[pca_data_met$class_match == "Reptilia","PC1"], col = rep_col, pch = 20, cex = 0.8)

points(log10(pca_data_met[pca_data_met$class_match == "Actinopterygii","met_rate"]), pca_data_met[pca_data_met$class_match == "Actinopterygii","PC1"], col = fish_col, pch = 20, cex = 0.8)

points(log10(pca_data_met[pca_data_met$class_match == "Gastropoda","met_rate"]), pca_data_met[pca_data_met$class_match == "Gastropoda","PC1"], col = gast_col, pch = 20, cex = 0.8)

points(log10(pca_data_met[pca_data_met$class_match == "Demospongiae","met_rate"]), pca_data_met[pca_data_met$class_match == "Demospongiae","PC1"], col = sponge_col, pch = 20, cex = 0.8)

points(log10(pca_data_met[pca_data_met$class_match == "Anthozoa","met_rate"]), pca_data_met[pca_data_met$class_match == "Anthozoa","PC1"], col = coral_col, pch = 20, cex = 0.8)

points(log10(pca_data_met[pca_data_met$class_match == "Bivalvia","met_rate"]), pca_data_met[pca_data_met$class_match == "Bivalvia","PC1"], col = biv_col, pch = 20, cex = 0.8)

abline(hdr(met_mod$Sol[,1])$mode, hdr(met_mod$Sol[,2])$mode)

```




reproduction productivity on PC2 axis
Need to allow this data and the met date flow through the scripts properly.
```{r repo size  tests}     
r_size_g <- vector()
notes <- vector()
trophic_again <- read.csv("Trophic_data_June16_2017.csv")

for(k in 1:length(pca_data$species_match)){
  
r_size_g[k] <- ((trophic_again[trophic_again$species  == as.vector(pca_data$species_match[k]),"repo_size_g"][1])*(trophic_again[trophic_again$species  == as.vector(pca_data$species_match[k]),"no_clutch_year"][1])*(as.numeric(as.vector(trophic_again[trophic_again$species  == as.vector(pca_data$species_match[k]),"clutch_no"][1]))))/((trophic_again[trophic_again$species  == as.vector(pca_data$species_match[k]),"mass_g"]))[1]

notes[k] <- as.character((trophic_again[trophic_again$species  == as.vector(pca_data$species_match[k]),"notes"][1]))

}


egg_size_data0 <- data.frame(PC1 = pca_data$PC1,
                            r_size_g, 
                            species = pca_data$species_match,
                            animal = pca_data$species_match,
                            taxa = pca_data$class_match,
                            notes = notes)

egg_size_data <- na.omit(egg_size_data0)


egg_size <- MCMCglmm(PC1 ~ r_size_g,
                     data = egg_size_data,
                     random=~animal + species,
                     pedigree = axis_trees[[1]], 
                     prior = prior, 
                     nitt = c(11000000), burnin = 1000000, thin = 5000, verbose = F)


egg_size_phylo <- egg_size$VCV[,1]/(egg_size$VCV[,1] +
                                         egg_size$VCV[,2] + 
                                         egg_size$VCV[,3])
egg_size_species <- egg_size$VCV[,2]/(egg_size$VCV[,1] +
                                         egg_size$VCV[,2] + 
                                         egg_size$VCV[,3])
egg_size_units <- egg_size$VCV[,3]/(egg_size$VCV[,1] +
                                         egg_size$VCV[,2] + 
                                         egg_size$VCV[,3])

hdr(egg_size_phylo)
hdr(egg_size_species)
hdr(egg_size_units)


```







###Next up plot the ellipses.



Adding some ellipses for taxinomic groups

```{r ellipse overlap}
###add some ellipses by just using the SIBER stuff


##Set up the data
iucn_statue <- pop_multree$data$iucn_statues
pca_data$iucn_statue <- iucn_statue

therm_PCA <- pop_multree$data$met_type
pca_data$therm_PCA <- therm_PCA


##first we need to set up the data tp be read in as if its an isotope.

siber_pca_data <- pca_data[pca_data$class_match =="Actinopterygii" |
                 pca_data$class_match == "Anthozoa"|
                 pca_data$class_match == "Aves"|
                 pca_data$class_match == "Gastropoda"|
                 pca_data$class_match == "Mammalia"|
                 pca_data$class_match == "Reptilia",]

sidpca <- data.frame(iso1 = siber_pca_data$PC1,
                     iso2 = siber_pca_data$PC2,
                     group = as.numeric(siber_pca_data$class_match),
                     community = rep(1,length(siber_pca_data$class_match)))


##we need to get rid of the 

sidmob <- data.frame(iso1 = pca_data$PC1,
                     iso2 = pca_data$PC2,
                     group = as.numeric(pca_data$mobility_PCA),
                     community = rep(1,length(pca_data$class_match)))


sidtherm <- data.frame(iso1 = pca_data$PC1,
                     iso2 = pca_data$PC2,
                     group = as.numeric(pca_data$therm_PCA),
                     community = rep(1,length(pca_data$class_match)))



pca_data$iucn_statue <- factor(pca_data$iucn_statue, levels = c("NA", "CE", "E", "LC", "LR", "NT", "V"))
pca_data$iucn_statue[is.na(pca_data$iucn_statue)] <- "NA"

sired <- na.omit(data.frame(iso1 = pca_data$PC1,
                     iso2 = pca_data$PC2,
                     group = as.numeric(pca_data$iucn_statue),
                     community = rep(1,length(pca_data$class_match))))


siber.plots <- createSiberObject(sidpca)
siber.mob <- createSiberObject(sidmob)
siber.therm <- createSiberObject(sidtherm)
siber.iucn<- createSiberObject(sired)



# Create lists of plotting arguments to be passed onwards to each 
# of the three plotting functions.
community.hulls.args <- list(col = 1, lty = 1, lwd = 1)

group.ellipses.args  <- list(n = 100, p.interval = 0.95, 
                             lty = 1, lwd = 2)

group.hull.args      <- list(lty = 2, col = "grey20")

#plot for taxa
plotSiberObject(siber.plots,
                  ax.pad = 2, 
                  hulls = F, community.hulls.args, 
                  ellipses = T, group.ellipses.args,
                  group.hulls = T, group.hull.args,
                  bty = "L",
                  iso.order = c(1,2),
                  xlab = "PC1",
                  ylab = "PC2"
                  )

#plot for mode-of-life
plotSiberObject(siber.mob,
                  ax.pad = 2, 
                  hulls = F, community.hulls.args, 
                  ellipses = T, group.ellipses.args,
                  group.hulls = F, group.hull.args,
                  bty = "L",
                  iso.order = c(1,2),
                  xlab = "PC1",
                  ylab = "PC2"
                  )

#plot for ecto endo
plotSiberObject(siber.therm,
                  ax.pad = 2, 
                  hulls = F, community.hulls.args, 
                  ellipses = T, group.ellipses.args,
                  group.hulls = F, group.hull.args,
                  bty = "L",
                  iso.order = c(1,2),
                  xlab = "PC1",
                  ylab = "PC2"
                  )

#plot for iucn
plotSiberObject(siber.iucn,
                  ax.pad = 2, 
                  hulls = F, community.hulls.args, 
                  ellipses = T, group.ellipses.args,
                  group.hulls = F, group.hull.args,
                  bty = "L",
                  iso.order = c(1,2),
                  xlab = "PC1",
                  ylab = "PC2"
                  )


```


Ellipse overlap calculations for taxa
```{r ellipse overlap taxa}

group.MLtaxa <- groupMetricsML(siber.plots)
group.MLmob <- groupMetricsML(siber.mob)


# options for running jags
parms <- list()
parms$n.iter <- 2 * 10^4   # number of iterations to run the model for
parms$n.burnin <- 1 * 10^3 # discard the first set of values
parms$n.thin <- 10     # thin the posterior by this many
parms$n.chains <- 2        # run this many chains

# define the priors
priors <- list()
priors$R <- 1 * diag(2)
priors$k <- 2
priors$tau.mu <- 1.0E-3



ellipses.posterior <- siberMVN(siber.plots, parms, priors)

# The first ellipse is referenced using a character string representation where 
# in "x.y", "x" is the community, and "y" is the group within that community.
# So in this example: community 1, group 1

#Actinopterygii
ellipse_Actinopterygii <- "1.1" 

#Anthozoa
ellipse_Anthozoa <- "1.2" 

#Aves
ellipse_Aves <- "1.3"

#Gastropoda
ellipse_Gastropoda <- "1.7" 

#Mammalia
ellipse_Mammalia <- "1.8" 

#Reptilia
ellipse_Reptilia <- "1.9"


#####fish - coral
AAn_95.overlap <- bayesianOverlap(ellipse_Actinopterygii, 
                                   ellipse_Anthozoa, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
AAn_95_overlap_prop <- vector()
for(i in 1:length(AAn_95.overlap$overlap)){

AAn_95_overlap_prop[i]  <- AAn_95.overlap$overlap[i]/min(AAn_95.overlap[i,1:2])
  
}

hist(AAn_95_overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_AAn = ggplot(data.frame(Overlap =  AAn_95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Fish  - Coral Overlap") +
                    geom_histogram(binwidth=0.1) + 
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AAn + theme_bw() + theme(panel.border = element_blank(), 
                                panel.grid.major = element_blank(),
                                panel.grid.minor = element_blank(), 
                                axis.line = element_line(colour = "black"),
                                text = element_text(size=20))



#####fish - aves
AAv95.overlap <- bayesianOverlap(ellipse_Actinopterygii, 
                                   ellipse_Aves, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

AAv_95_overlap_prop <- vector()
for(i in 1:length(AAv95.overlap$overlap)){

AAv_95_overlap_prop[i]  <- AAv95.overlap$overlap[i]/min(AAv95.overlap[i,1:2])
  
}

hist(AAv_95_overlap_prop, xlab = "Proportion of overlap", main = "", xlim = c(0,1))
hdr(AAv_95_overlap_prop)

myplot_Aav = ggplot(data.frame(Overlap =  AAv_95_overlap_prop),
                    aes(Overlap)) +
                    geom_histogram(binwidth=0.1) +
                    ggtitle("Fish  - Aves Overlap") +
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Aav + theme_bw() + theme(panel.border = element_blank(), 
                                panel.grid.major = element_blank(),
                                panel.grid.minor = element_blank(), 
                                axis.line = element_line(colour = "black"),
                                text = element_text(size=20))

#####fish - gastropod
AG95.overlap <- bayesianOverlap(ellipse_Actinopterygii, 
                                   ellipse_Gastropoda, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

AG_95_overlap_prop <- vector()
for(i in 1:length(AG95.overlap$overlap)){

AG_95_overlap_prop[i]  <- AG95.overlap$overlap[i]/min(AG95.overlap[i,1:2])
  
}


myplot_AG = ggplot(data.frame(Overlap =  AG_95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Fish  - Gastropod Overlap") +
                    geom_histogram(binwidth=0.1) + 
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AG + theme_bw() + theme(panel.border = element_blank(),
                               panel.grid.major = element_blank(),
                               panel.grid.minor = element_blank(), 
                               axis.line = element_line(colour = "black"),
                               text = element_text(size=20))



##fish - mammal
AM95.overlap <- bayesianOverlap(ellipse_Actinopterygii, 
                                   ellipse_Mammalia, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

Am_95_overlap_prop <- vector()
for(i in 1:length(AM95.overlap$overlap)){

Am_95_overlap_prop[i]  <- AM95.overlap$overlap[i]/min(AM95.overlap[i,1:2])
  
}

myplot_AM = ggplot(data.frame(Overlap =  Am_95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Fish  - Mammal Overlap") +
                    geom_histogram(binwidth=0.1) + 
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AM + theme_bw() + theme(panel.border = element_blank(), 
                               panel.grid.major = element_blank(),
                               panel.grid.minor = element_blank(), 
                               axis.line = element_line(colour = "black"),
                               text = element_text(size=20))


###fish and reptiles
AR95.overlap <- bayesianOverlap(ellipse_Actinopterygii, 
                                   ellipse_Reptilia, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

AR_95_overlap_prop <- vector()
for(i in 1:length(AR95.overlap$overlap)){

AR_95_overlap_prop[i]  <- AR95.overlap$overlap[i]/min(AR95.overlap[i,1:2])
  
}

myplot_AR = ggplot(data.frame(Overlap =  AR_95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Fish  - Reptiles Overlap") +
                    geom_histogram(binwidth=0.1) + 
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AR + theme_bw() + theme(panel.border = element_blank(), 
                               panel.grid.major = element_blank(),
                               panel.grid.minor = element_blank(), 
                               axis.line = element_line(colour = "black"),
                               text = element_text(size=20))



###coral-gastropod
AnG95.overlap <- bayesianOverlap(ellipse_Anthozoa, 
                                   ellipse_Gastropoda, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

AnG95_overlap_prop <- vector()
for(i in 1:length(AnG95.overlap$overlap)){

AnG95_overlap_prop[i]  <- AnG95.overlap$overlap[i]/min(AnG95.overlap[i,1:2])
  
}

myplot_AnG = ggplot(data.frame(Overlap =  AnG95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Coral  - Gastropods Overlap") +
                    geom_histogram(binwidth=0.1) + 
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AnG + theme_bw() + theme(panel.border = element_blank(), 
                                panel.grid.major = element_blank(),
                                panel.grid.minor = element_blank(), 
                                axis.line = element_line(colour = "black"),
                                text = element_text(size=20))


##coral mammal
AnM95.overlap <- bayesianOverlap(ellipse_Anthozoa, 
                                   ellipse_Mammalia, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)


AnM95_overlap_prop <- vector()
for(i in 1:length(AnG95.overlap$overlap)){

AnM95_overlap_prop[i]  <- AnM95.overlap$overlap[i]/min(AnM95.overlap[i,1:2])
  
}

myplot_AnM = ggplot(data.frame(Overlap =  AnM95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Coral  - Mammal Overlap") +
                    geom_histogram(binwidth=0.1) + 
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AnM + theme_bw() + theme(panel.border = element_blank(), 
                                panel.grid.major = element_blank(),
                                panel.grid.minor = element_blank(), 
                                axis.line = element_line(colour = "black"),
                                text = element_text(size=20))


##coral reptile
AnR95.overlap <- bayesianOverlap(ellipse_Anthozoa, 
                                   ellipse_Reptilia, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)


AnR95_overlap_prop <- vector()
for(i in 1:length(AnR95.overlap$overlap)){

AnR95_overlap_prop[i]  <- AnR95.overlap$overlap[i]/min(AnR95.overlap[i,1:2])
  
}

myplot_AnR = ggplot(data.frame(Overlap =  AnR95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Coral  - Reptile Overlap") +
                    geom_histogram(binwidth=0.1) + 
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AnR + theme_bw() + theme(panel.border = element_blank(), 
                                panel.grid.major = element_blank(),
                                panel.grid.minor = element_blank(), 
                                axis.line = element_line(colour = "black"),
                                text = element_text(size=20))



###bird - gastropd

AvG95.overlap <- bayesianOverlap(ellipse_Aves, 
                                   ellipse_Gastropoda, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

AvG95_overlap_prop <- vector()
for(i in 1:length(AvG95.overlap$overlap)){

AvG95_overlap_prop[i]  <- AvG95.overlap$overlap[i]/min(AvG95.overlap[i,1:2])
  
}

myplot_AvG = ggplot(data.frame(Overlap =  AvG95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Aves  - Gastropod Overlap") +
                    geom_histogram(binwidth=0.1) + 
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AvG + theme_bw() + theme(panel.border = element_blank(), 
                                panel.grid.major = element_blank(),
                                panel.grid.minor = element_blank(), 
                                axis.line = element_line(colour = "black"),
                                text = element_text(size=20))


####aves mammal
AvM95.overlap <- bayesianOverlap(ellipse_Aves, 
                                   ellipse_Mammalia, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

AvM95_overlap_prop <- vector()
for(i in 1:length(AvM95.overlap$overlap)){

AvM95_overlap_prop[i]  <- AvM95.overlap$overlap[i]/min(AvM95.overlap[i,1:2])
  
}

myplot_AvM = ggplot(data.frame(Overlap =  AvM95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Aves  - Mammal Overlap") +
                    geom_histogram(binwidth=0.1) + 
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AvM + theme_bw() + theme(panel.border = element_blank(), 
                                panel.grid.major = element_blank(),
                                panel.grid.minor = element_blank(), 
                                axis.line = element_line(colour = "black"),
                                text = element_text(size=20))



##### Aves reptile

AvRR95.overlap <- bayesianOverlap(ellipse_Aves, 
                                   ellipse_Reptilia, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

AvR95_overlap_prop <- vector()
for(i in 1:length(AvRR95.overlap$overlap)){

AvR95_overlap_prop[i]  <- AvRR95.overlap$overlap[i]/min(AvRR95.overlap[i,1:2])
  
}

myplot_AvR = ggplot(data.frame(Overlap =  AvR95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Aves  - Reptile Overlap") +
                    geom_histogram(binwidth=0.1) + 
                    scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AvR + theme_bw() + theme(panel.border = element_blank(), 
                                panel.grid.major = element_blank(),
                                panel.grid.minor = element_blank(), 
                                axis.line = element_line(colour = "black"),
                                text = element_text(size=20))




##### reptile gastropod

RG95.overlap <- bayesianOverlap(ellipse_Reptilia, 
                                   ellipse_Gastropoda, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

RG95_overlap_prop <- vector()
for(i in 1:length(RG95.overlap$overlap)){

RG95_overlap_prop[i]  <- RG95.overlap$overlap[i]/min(RG95.overlap[i,1:2])
  
}

myplot_RG = ggplot(data.frame(Overlap =  RG95_overlap_prop),
                    aes(Overlap)) +
                    ggtitle("Reptile  - Gastropod Overlap") +

  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_RG + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))


ggsave("reptile_gastropod.png", dpi=300, width=4, height=3)

#hdr(RG95_overlap_prop)



##### Aves coral

AvAn95.overlap <- bayesianOverlap(ellipse_Aves, 
                                   ellipse_Anthozoa, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

AvAn95_overlap_prop <- vector()
for(i in 1:length(AvAn95.overlap$overlap)){

AvAn95_overlap_prop[i]  <- AvAn95.overlap$overlap[i]/min(AvAn95.overlap[i,1:2])
  
}

myplot_AvAn = ggplot(data.frame(Overlap =  AvAn95_overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_AvAn + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))


ggsave("aves_coral.png", dpi=300, width=4, height=3)

#hdr(AvAn95_overlap_prop, h = 100)



##### reptile mammal

RM95.overlap <- bayesianOverlap(ellipse_Mammalia, 
                                   ellipse_Reptilia, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

RM95_overlap_prop <- vector()
for(i in 1:length(RG95.overlap$overlap)){

RM95_overlap_prop[i]  <- RM95.overlap$overlap[i]/min(RM95.overlap[i,1:2])
  
}

myplot_RM = ggplot(data.frame(Overlap =  RM95_overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_RM + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))


ggsave("reptile_mammal.png", dpi=300, width=4, height=3)

#hdr(RM95_overlap_prop)


#####  mammal gastropod

MG95.overlap <- bayesianOverlap(ellipse_Mammalia, 
                                   ellipse_Gastropoda, 
                                   ellipses.posterior,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)

MG95_overlap_prop <- vector()
for(i in 1:length(RG95.overlap$overlap)){

MG95_overlap_prop[i]  <- MG95.overlap$overlap[i]/min(MG95.overlap[i,1:2])
  
}

myplot_MG = ggplot(data.frame(Overlap =  MG95_overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_MG + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))


ggsave("mammal_gastropod.png", dpi=300, width=4, height=3)

hdr(MG95_overlap_prop)


```



Ellipse overlap calculations for mode of life
```{r ellipse overlap mode of life}

group.ML <- groupMetricsML(siber.plots)
group.MLmob <- groupMetricsML(siber.mob)


# options for running jags
parms <- list()
parms$n.iter <- 2 * 10^4   # number of iterations to run the model for
parms$n.burnin <- 1 * 10^3 # discard the first set of values
parms$n.thin <- 10     # thin the posterior by this many
parms$n.chains <- 2        # run this many chains

# define the priors
priors <- list()
priors$R <- 1 * diag(2)
priors$k <- 2
priors$tau.mu <- 1.0E-3



ellipses.posterior_mob <- siberMVN(siber.mob, parms, priors)

# The first ellipse is referenced using a character string representation where 
# in "x.y", "x" is the community, and "y" is the group within that community.
# So in this example: community 1, group 1

#ellipse group numbers
ellipse_sessile <- "1.1" 
ellipse_arboreal <- "1.2" 
ellipse_benthic <- "1.3"
ellipse_volant <- "1.4" 
ellipse_semiaquatic <- "1.5" 
ellipse_terrestrial <- "1.6"
ellipse_pelagic <- "1.7"
ellipse_semifossorial <- "1.8"


#####sessile  - arboreal
SA_95.overlap <- bayesianOverlap(ellipse_sessile, 
                                   ellipse_arboreal, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
SA_95.overlap_prop <- vector()
for(i in 1:length(SA_95.overlap$overlap)){

SA_95.overlap_prop[i]  <- SA_95.overlap$overlap[i]/min(SA_95.overlap[i,1:2])
  
}

hist(SA_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_SA = ggplot(data.frame(Overlap =  SA_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_SA + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("sessil_arboreal.png", dpi=300, width=4, height=3)

hdr(SA_95.overlap_prop, h = 10)

#####sessile  - benthic
SB_95.overlap <- bayesianOverlap(ellipse_sessile, 
                                   ellipse_benthic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
SB_95.overlap_prop <- vector()
for(i in 1:length(SB_95.overlap$overlap)){

SB_95.overlap_prop[i]  <- SB_95.overlap$overlap[i]/min(SB_95.overlap[i,1:2])
  
}

hist(SB_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_SB = ggplot(data.frame(Overlap =  SB_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_SB + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("sessil_benthic.png", dpi=300, width=4, height=3)

#hdr(SB_95.overlap_prop, h = 10)


#####sessile  - volant
Sv_95.overlap <- bayesianOverlap(ellipse_sessile, 
                                   ellipse_volant, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Sv_95.overlap_prop <- vector()
for(i in 1:length(Sv_95.overlap$overlap)){

Sv_95.overlap_prop[i]  <- Sv_95.overlap$overlap[i]/min(Sv_95.overlap[i,1:2])
  
}

hist(Sv_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Sv = ggplot(data.frame(Overlap =  Sv_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Sv + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("sessil_volant.png", dpi=300, width=4, height=3)

#hdr(Sv_95.overlap_prop, h = 10)



#####sessile  - semiaquatic
Ssem_95.overlap <- bayesianOverlap(ellipse_sessile, 
                                   ellipse_semiaquatic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Ssem_95.overlap_prop <- vector()
for(i in 1:length(Ssem_95.overlap$overlap)){

Ssem_95.overlap_prop[i]  <- Ssem_95.overlap$overlap[i]/min(Ssem_95.overlap[i,1:2])
  
}

hist(Ssem_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Ssem = ggplot(data.frame(Overlap =  Ssem_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Ssem + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("sessil_semiaquativ.png", dpi=300, width=4, height=3)

#hdr(Ssem_95.overlap_prop, h = 10)


#####sessile  - terrestrial

St_95.overlap <- bayesianOverlap(ellipse_sessile, 
                                   ellipse_terrestrial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
St_95.overlap_prop <- vector()
for(i in 1:length(St_95.overlap$overlap)){

St_95.overlap_prop[i]  <- St_95.overlap$overlap[i]/min(St_95.overlap[i,1:2])
  
}

hist(St_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_St = ggplot(data.frame(Overlap =  St_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_St + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("sessil_terrestrial.png", dpi=300, width=4, height=3)

#hdr(St_95.overlap_prop, h = 10)


#####sessile  - pelagic
Sp_95.overlap <- bayesianOverlap(ellipse_sessile, 
                                   ellipse_pelagic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Sp_95.overlap_prop <- vector()
for(i in 1:length(Sp_95.overlap$overlap)){

Sp_95.overlap_prop[i]  <- Sp_95.overlap$overlap[i]/min(Sp_95.overlap[i,1:2])
  
}

hist(Sp_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Sp = ggplot(data.frame(Overlap =  Sp_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Sp + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("sessil_pelagic.png", dpi=300, width=4, height=3)

#hdr(Sp_95.overlap_prop, h = 10)


#####sessile  - semifossorial
Ssf_95.overlap <- bayesianOverlap(ellipse_sessile, 
                                   ellipse_semifossorial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Ssf_95.overlap_prop <- vector()
for(i in 1:length(Ssf_95.overlap$overlap)){

Ssf_95.overlap_prop[i]  <- Ssf_95.overlap$overlap[i]/min(Ssf_95.overlap[i,1:2])
  
}

hist(Ssf_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Ssf = ggplot(data.frame(Overlap =  Ssf_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Ssf + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("sessil_semifoss.png", dpi=300, width=4, height=3)

#hdr(Ssf_95.overlap_prop, h = 10)


#####arboreal  - benthic
Ab_95.overlap <- bayesianOverlap(ellipse_arboreal, 
                                   ellipse_benthic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Ab_95.overlap_prop <- vector()
for(i in 1:length(Ab_95.overlap$overlap)){

Ab_95.overlap_prop[i]  <- Ab_95.overlap$overlap[i]/min(Ab_95.overlap[i,1:2])
  
}

hist(Ab_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Ab = ggplot(data.frame(Overlap =  Ab_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Ab + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("arboreal_benthic.png", dpi=300, width=4, height=3)

#hdr(Ab_95.overlap_prop, h = 10)



#####arboreal  - volant
Av_95.overlap <- bayesianOverlap(ellipse_arboreal, 
                                   ellipse_volant, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Av_95.overlap_prop <- vector()
for(i in 1:length(Av_95.overlap$overlap)){

Av_95.overlap_prop[i]  <- Av_95.overlap$overlap[i]/min(Av_95.overlap[i,1:2])
  
}

hist(Av_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Av = ggplot(data.frame(Overlap =  Av_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Av + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("arboreal_volant.png", dpi=300, width=4, height=3)

#hdr(Av_95.overlap_prop, h = 10)

#####arboreal  - semiaquatic
Asemi_95.overlap <- bayesianOverlap(ellipse_arboreal, 
                                   ellipse_semiaquatic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Asemi_95.overlap_prop <- vector()
for(i in 1:length(Av_95.overlap$overlap)){

Asemi_95.overlap_prop[i]  <- Asemi_95.overlap$overlap[i]/min(Asemi_95.overlap[i,1:2])
  
}

hist(Asemi_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Asemi = ggplot(data.frame(Overlap =  Asemi_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Asemi + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("arboreal_semiaquatic.png", dpi=300, width=4, height=3)

#hdr(Asemi_95.overlap_prop, h = 10)

#####arboreal  - terrestrial
At_95.overlap <- bayesianOverlap(ellipse_arboreal, 
                                   ellipse_terrestrial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
At_95.overlap_prop <- vector()
for(i in 1:length(At_95.overlap$overlap)){

At_95.overlap_prop[i]  <- At_95.overlap$overlap[i]/min(At_95.overlap[i,1:2])
  
}

hist(At_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_At = ggplot(data.frame(Overlap =  At_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_At + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("arboreal_terrestrial.png", dpi=300, width=4, height=3)

#hdr(At_95.overlap_prop, h = 10)

#####arboreal  - pelagic
Ap_95.overlap <- bayesianOverlap(ellipse_arboreal, 
                                   ellipse_pelagic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Ap_95.overlap_prop <- vector()
for(i in 1:length(Ap_95.overlap$overlap)){

Ap_95.overlap_prop[i]  <- Ap_95.overlap$overlap[i]/min(Ap_95.overlap[i,1:2])
  
}

hist(Ap_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Ap = ggplot(data.frame(Overlap =  Ap_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Ap + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("arboreal_pelegic.png", dpi=300, width=4, height=3)

#hdr(Ap_95.overlap_prop, h = 10)

#####arboreal  - semifossorial
Afoss_95.overlap <- bayesianOverlap(ellipse_arboreal, 
                                   ellipse_semifossorial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Afoss_95.overlap_prop <- vector()
for(i in 1:length(Afoss_95.overlap$overlap)){

Afoss_95.overlap_prop[i]  <- Afoss_95.overlap$overlap[i]/min(Afoss_95.overlap[i,1:2])
  
}

hist(Afoss_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Afoss = ggplot(data.frame(Overlap =  Afoss_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Afoss + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("arboreal_semifossorial.png", dpi=300, width=4, height=3)

#hdr(Afoss_95.overlap_prop, h = 10)


#####benthic  - volant
Bv_95.overlap <- bayesianOverlap(ellipse_benthic, 
                                   ellipse_volant, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Bv_95.overlap_prop <- vector()
for(i in 1:length(Bv_95.overlap$overlap)){

Bv_95.overlap_prop[i]  <- Bv_95.overlap$overlap[i]/min(Bv_95.overlap[i,1:2])
  
}

hist(Bv_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Bv = ggplot(data.frame(Overlap =  Bv_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Bv + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("benthic_volant.png", dpi=300, width=4, height=3)

#hdr(Bv_95.overlap_prop, h = 10)


#####benthic  - semiaquatic
Bsemia_95.overlap <- bayesianOverlap(ellipse_benthic, 
                                   ellipse_semiaquatic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Bsemia_95.overlap_prop <- vector()
for(i in 1:length(Bsemia_95.overlap$overlap)){

Bsemia_95.overlap_prop[i]  <- Bsemia_95.overlap$overlap[i]/min(Bsemia_95.overlap[i,1:2])
  
}

hist(Bsemia_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Bsemia = ggplot(data.frame(Overlap =  Bsemia_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Bsemia + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("benthic_semiaquatic.png", dpi=300, width=4, height=3)

#hdr(Bsemia_95.overlap_prop, h = 10)



#####benthic  - terrestrial
Bt_95.overlap <- bayesianOverlap(ellipse_benthic, 
                                   ellipse_terrestrial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Bt_95.overlap_prop <- vector()
for(i in 1:length(Bt_95.overlap$overlap)){

Bt_95.overlap_prop[i]  <- Bt_95.overlap$overlap[i]/min(Bt_95.overlap[i,1:2])
  
}

hist(Bt_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Bt = ggplot(data.frame(Overlap =  Bt_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Bt + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("benthic_terrestrial.png", dpi=300, width=4, height=3)

#hdr(Bt_95.overlap_prop, h = 10)




#####benthic  - pelagic
Bp_95.overlap <- bayesianOverlap(ellipse_benthic, 
                                   ellipse_pelagic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Bp_95.overlap_prop <- vector()
for(i in 1:length(Bp_95.overlap$overlap)){

Bp_95.overlap_prop[i]  <- Bp_95.overlap$overlap[i]/min(Bp_95.overlap[i,1:2])
  
}

hist(Bp_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Bp = ggplot(data.frame(Overlap =  Bp_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Bp + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("benthic_pelagic.png", dpi=300, width=4, height=3)

#hdr(Bp_95.overlap_prop, h = 10)



#####benthic  - semifossorial
Bfoss_95.overlap <- bayesianOverlap(ellipse_benthic, 
                                   ellipse_semifossorial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Bfoss_95.overlap_prop <- vector()
for(i in 1:length(Bfoss_95.overlap$overlap)){

Bfoss_95.overlap_prop[i]  <- Bfoss_95.overlap$overlap[i]/min(Bfoss_95.overlap[i,1:2])
  
}

hist(Bfoss_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Bfoss = ggplot(data.frame(Overlap =  Bfoss_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Bfoss + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("benthic_semifoss.png", dpi=300, width=4, height=3)

#hdr(Bfoss_95.overlap_prop, h = 10)



#####volant  - semiaquatic
Vsem_95.overlap <- bayesianOverlap(ellipse_volant, 
                                   ellipse_semiaquatic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Vsem_95.overlap_prop <- vector()
for(i in 1:length(Vsem_95.overlap$overlap)){

Vsem_95.overlap_prop[i]  <- Vsem_95.overlap$overlap[i]/min(Vsem_95.overlap[i,1:2])
  
}

hist(Vsem_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Vsem = ggplot(data.frame(Overlap =  Vsem_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Vsem + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("volant_semiaquatic.png", dpi=300, width=4, height=3)

#hdr(Vsem_95.overlap_prop, h = 10)



#####volant  - terrestrial
Vt_95.overlap <- bayesianOverlap(ellipse_volant, 
                                   ellipse_terrestrial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Vt_95.overlap_prop <- vector()
for(i in 1:length(Vt_95.overlap$overlap)){

Vt_95.overlap_prop[i]  <- Vt_95.overlap$overlap[i]/min(Vt_95.overlap[i,1:2])
  
}

hist(Vt_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Vt = ggplot(data.frame(Overlap =  Vt_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Vt + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("volant_terrestrial.png", dpi=300, width=4, height=3)

#hdr(Vt_95.overlap_prop, h = 10)



#####volant  - pelagic
Vp_95.overlap <- bayesianOverlap(ellipse_volant, 
                                   ellipse_pelagic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Vp_95.overlap_prop <- vector()
for(i in 1:length(Vp_95.overlap$overlap)){

Vp_95.overlap_prop[i]  <- Vp_95.overlap$overlap[i]/min(Vp_95.overlap[i,1:2])
  
}

hist(Vp_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Vp = ggplot(data.frame(Overlap =  Vp_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Vp + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("volant_pelegic.png", dpi=300, width=4, height=3)

#hdr(Vp_95.overlap_prop, h = 10)



#####volant  - semifossorial
Vsfoss_95.overlap <- bayesianOverlap(ellipse_volant, 
                                   ellipse_semifossorial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Vsfoss_95.overlap_prop <- vector()
for(i in 1:length(Vsfoss_95.overlap$overlap)){

Vsfoss_95.overlap_prop[i]  <- Vsfoss_95.overlap$overlap[i]/min(Vsfoss_95.overlap[i,1:2])
  
}

hist(Vsfoss_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Vsfoss = ggplot(data.frame(Overlap = Vsfoss_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Vsfoss + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("volant_semifoss.png", dpi=300, width=4, height=3)

#hdr(Vsfoss_95.overlap_prop, h = 10)


#####semiaquatic  - terrestrial
SAt_95.overlap <- bayesianOverlap(ellipse_semiaquatic, 
                                   ellipse_terrestrial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
SAt_95.overlap_prop <- vector()
for(i in 1:length(SAt_95.overlap$overlap)){

SAt_95.overlap_prop[i]  <- SAt_95.overlap$overlap[i]/min(SAt_95.overlap[i,1:2])
  
}

hist(SAt_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_SAt = ggplot(data.frame(Overlap = SAt_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_SAt + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("semiaqu_terrestrial.png", dpi=300, width=4, height=3)

#hdr(SAt_95.overlap_prop, h = 10)


#####semiaquatic  - pelagic
SAp_95.overlap <- bayesianOverlap(ellipse_semiaquatic, 
                                   ellipse_pelagic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
SAp_95.overlap_prop <- vector()
for(i in 1:length(SAp_95.overlap$overlap)){

SAp_95.overlap_prop[i]  <- SAp_95.overlap$overlap[i]/min(SAp_95.overlap[i,1:2])
  
}

hist(SAp_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_SAp = ggplot(data.frame(Overlap = SAp_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_SAp + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("semiaqu_pelegic.png", dpi=300, width=4, height=3)

#hdr(SAp_95.overlap_prop, h = 10)



#####semiaquatic  - semifossorial
SAsfoss_95.overlap <- bayesianOverlap(ellipse_semiaquatic, 
                                   ellipse_semifossorial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
SAsfoss_95.overlap_prop <- vector()
for(i in 1:length(SAsfoss_95.overlap$overlap)){

SAsfoss_95.overlap_prop[i]  <- SAsfoss_95.overlap$overlap[i]/min(SAsfoss_95.overlap[i,1:2])
  
}

hist(SAsfoss_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_SAsfoss = ggplot(data.frame(Overlap = SAsfoss_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_SAsfoss + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("semiaqu_semifoss.png", dpi=300, width=4, height=3)

#hdr(SAsfoss_95.overlap_prop, h = 10)



#####terrestrial  - pelagic
Tp_95.overlap <- bayesianOverlap(ellipse_terrestrial, 
                                   ellipse_pelagic, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Tp_95.overlap_prop <- vector()
for(i in 1:length(Tp_95.overlap$overlap)){

Tp_95.overlap_prop[i]  <- Tp_95.overlap$overlap[i]/min(Tp_95.overlap[i,1:2])
  
}

hist(Tp_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Tp = ggplot(data.frame(Overlap = Tp_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Tp + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("terrestrial_pelegic.png", dpi=300, width=4, height=3)

#hdr(Tp_95.overlap_prop, h = 10)


#####terrestrial  - semifossorial
Tfoss_95.overlap <- bayesianOverlap(ellipse_terrestrial, 
                                   ellipse_semifossorial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Tfoss_95.overlap_prop <- vector()
for(i in 1:length(Tfoss_95.overlap$overlap)){

Tfoss_95.overlap_prop[i]  <- Tfoss_95.overlap$overlap[i]/min(Tfoss_95.overlap[i,1:2])
  
}

hist(Tfoss_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Tfoss = ggplot(data.frame(Overlap = Tfoss_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Tfoss + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("terrestrial_semifoss.png", dpi=300, width=4, height=3)

#hdr(Tfoss_95.overlap_prop, h = 10)



#####pelagic  - semifossorial
Psfoss_95.overlap <- bayesianOverlap(ellipse_pelagic, 
                                   ellipse_semifossorial, 
                                   ellipses.posterior_mob,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
Psfoss_95.overlap_prop <- vector()
for(i in 1:length(Psfoss_95.overlap$overlap)){

Psfoss_95.overlap_prop[i]  <- Psfoss_95.overlap$overlap[i]/min(Psfoss_95.overlap[i,1:2])
  
}

hist(Psfoss_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_Psfoss = ggplot(data.frame(Overlap = Psfoss_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_Psfoss + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("pelegic_semifoss.png", dpi=300, width=4, height=3)

#hdr(Psfoss_95.overlap_prop, h = 10)



```











IUCN  overlap calculations for mode of life
```{r ellipse overlap iucn}

group.ML <- groupMetricsML(siber.plots)
group.ML_iucn <- groupMetricsML(siber.iucn)


# options for running jags
parms <- list()
parms$n.iter <- 2 * 10^4   # number of iterations to run the model for
parms$n.burnin <- 1 * 10^3 # discard the first set of values
parms$n.thin <- 10     # thin the posterior by this many
parms$n.chains <- 2        # run this many chains

# define the priors
priors <- list()
priors$R <- 1 * diag(2)
priors$k <- 2
priors$tau.mu <- 1.0E-3



ellipses.posterior_iucn <- siberMVN(siber.iucn, parms, priors)

# The first ellipse is referenced using a character string representation where 
# in "x.y", "x" is the community, and "y" is the group within that community.
# So in this example: community 1, group 1


#ellipse group numbers
ellipse_NA <- "1.1" 
ellipse_CE <- "1.2" 
ellipse_E <- "1.3"
ellipse_LC <- "1.4" 
ellipse_LR <- "1.5" 
ellipse_NT <- "1.6"
ellipse_V <- "1.7"


#####LC  - NT
LC_NT_95.overlap <- bayesianOverlap(ellipse_LC, 
                                   ellipse_E, 
                                   ellipses.posterior_iucn,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
LC_NT_95.overlap_prop <- vector()
for(i in 1:length(LC_NT_95.overlap$overlap)){

LC_NT_95.overlap_prop[i]  <- LC_NT_95.overlap$overlap[i]/min(LC_NT_95.overlap[i,1:2])
  
}

hist(LC_NT_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_LC_NT = ggplot(data.frame(Overlap =  LC_NT_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_LC_NT + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("LC_NT.png", dpi=300, width=4, height=3)

#hdr(LC_NT_95.overlap_prop, h = 10)






#####LC  - V
LC_V_95.overlap <- bayesianOverlap(ellipse_LC, 
                                   ellipse_V, 
                                   ellipses.posterior_iucn,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
LC_V_95.overlap_prop <- vector()
for(i in 1:length(LC_V_95.overlap$overlap)){

LC_V_95.overlap_prop[i]  <- LC_V_95.overlap$overlap[i]/min(LC_V_95.overlap[i,1:2])
  
}

hist(LC_V_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_LC_V = ggplot(data.frame(Overlap =  LC_V_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_LC_V + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("LC_V.png", dpi=300, width=4, height=3)

#hdr(LC_V_95.overlap_prop, h = 10)






#####LC  - E
LC_E_95.overlap <- bayesianOverlap(ellipse_LC, 
                                   ellipse_E, 
                                   ellipses.posterior_iucn,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
LC_E_95.overlap_prop <- vector()
for(i in 1:length(LC_E_95.overlap$overlap)){

LC_E_95.overlap_prop[i]  <- LC_E_95.overlap$overlap[i]/min(LC_E_95.overlap[i,1:2])
  
}

hist(LC_E_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_LC_E = ggplot(data.frame(Overlap =  LC_E_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_LC_E + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("LC_E.png", dpi=300, width=4, height=3)

#hdr(LC_E_95.overlap_prop, h = 10)






#####LC  - CE
LC_CE_95.overlap <- bayesianOverlap(ellipse_LC, 
                                   ellipse_CE, 
                                   ellipses.posterior_iucn,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
LC_CE_95.overlap_prop <- vector()
for(i in 1:length(LC_CE_95.overlap$overlap)){

LC_CE_95.overlap_prop[i]  <- LC_CE_95.overlap$overlap[i]/min(LC_CE_95.overlap[i,1:2])
  
}

hist(LC_CE_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_LC_CE = ggplot(data.frame(Overlap =  LC_CE_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_LC_CE + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("LC_CE.png", dpi=300, width=4, height=3)

#hdr(LC_CE_95.overlap_prop, h = 10)






#####NT  - V
NT_V_95.overlap <- bayesianOverlap(ellipse_NT, 
                                   ellipse_V, 
                                   ellipses.posterior_iucn,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
NT_V_95.overlap_prop <- vector()
for(i in 1:length(NT_V_95.overlap$overlap)){

NT_V_95.overlap_prop[i]  <- NT_V_95.overlap$overlap[i]/min(NT_V_95.overlap[i,1:2])
  
}

hist(NT_V_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_NT_V = ggplot(data.frame(Overlap =  NT_V_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_NT_V + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("NT_V.png", dpi=300, width=4, height=3)

#hdr(NT_V_95.overlap_prop, h = 10)






#####NT  - E
NT_E_95.overlap <- bayesianOverlap(ellipse_NT, 
                                   ellipse_E, 
                                   ellipses.posterior_iucn,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
NT_E_95.overlap_prop <- vector()
for(i in 1:length(NT_E_95.overlap$overlap)){

NT_E_95.overlap_prop[i]  <- NT_E_95.overlap$overlap[i]/min(NT_E_95.overlap[i,1:2])
  
}

hist(NT_E_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_NT_E = ggplot(data.frame(Overlap =  NT_E_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_NT_E + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("NT_E.png", dpi=300, width=4, height=3)

#hdr(NT_E_95.overlap_prop)






#####NT  - CE
NT_CE_95.overlap <- bayesianOverlap(ellipse_NT, 
                                   ellipse_CE, 
                                   ellipses.posterior_iucn,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
NT_CE_95.overlap_prop <- vector()
for(i in 1:length(NT_CE_95.overlap$overlap)){

NT_CE_95.overlap_prop[i]  <- NT_CE_95.overlap$overlap[i]/min(NT_CE_95.overlap[i,1:2])
  
}

hist(NT_CE_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_NT_CE = ggplot(data.frame(Overlap =  NT_CE_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_NT_CE + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("NT_CE.png", dpi=300, width=4, height=3)

#hdr(NT_CE_95.overlap_prop, h = 10)






#####E  - CE
E_CE_95.overlap <- bayesianOverlap(ellipse_E, 
                                   ellipse_CE, 
                                   ellipses.posterior_iucn,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
E_CE_95.overlap_prop <- vector()
for(i in 1:length(E_CE_95.overlap$overlap)){

E_CE_95.overlap_prop[i]  <- E_CE_95.overlap$overlap[i]/min(E_CE_95.overlap[i,1:2])
  
}

hist(E_CE_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_E_CE = ggplot(data.frame(Overlap =  E_CE_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_E_CE + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("E_CE.png", dpi=300, width=4, height=3)

#hdr(E_CE_95.overlap_prop)





#####E  - V
E_V_95.overlap <- bayesianOverlap(ellipse_E, 
                                   ellipse_V, 
                                   ellipses.posterior_iucn,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
E_V_95.overlap_prop <- vector()
for(i in 1:length(E_V_95.overlap$overlap)){

E_V_95.overlap_prop[i]  <- E_V_95.overlap$overlap[i]/min(E_V_95.overlap[i,1:2])
  
}

hist(E_V_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_E_V = ggplot(data.frame(Overlap =  E_V_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_E_V + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("E_V.png", dpi=300, width=4, height=3)

#hdr(E_V_95.overlap_prop)






#####CE  - V
CE_V_95.overlap <- bayesianOverlap(ellipse_CE, 
                                   ellipse_V, 
                                   ellipses.posterior_iucn,
                                   draws = 100, 
                                   p.interval = 0.95, 
                                   n = 100)
CE_V_95.overlap_prop <- vector()
for(i in 1:length(CE_V_95.overlap$overlap)){

CE_V_95.overlap_prop[i]  <- CE_V_95.overlap$overlap[i]/min(CE_V_95.overlap[i,1:2])
  
}

hist(CE_V_95.overlap_prop, xlab = "Proportion of overlap", main = "")

myplot_CE_V = ggplot(data.frame(Overlap =  CE_V_95.overlap_prop),
                    aes(Overlap)) +
  geom_histogram(binwidth=0.1) + 
  scale_x_continuous(limits = c(-0.05, 1.05))

myplot_CE_V + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
text = element_text(size=20))

ggsave("CE_V.png", dpi=300, width=4, height=3)

#hdr(CE_V_95.overlap_prop)



```




juvinal Survival versus standard deviation in mortality
```{r repo size  tests}     

prior<-list(R = list(V = 1/2, nu=0.002), 
            G = list(G1=list(V = 1/2,n = 1, alpha.mu=rep(0,1), alpha.V= diag(1)*10^3), 
                     G1=list(V = 1/2,n = 1, alpha.mu=rep(0,1), alpha.V= diag(1)*10^3)))

juv_data <- data.frame(surv_sd = as.vector(pop_data$surv_sd),
                       prop_la = as.vector(pop_data$prop_la),
                       animal = pop_data$animal,
                       species = pop_data$species)




j_surv <- MCMCglmm(prop_la ~ surv_sd,
                     data = juv_data,
                     random=~animal + species,
                     pedigree = axis_trees[[1]], 
                     prior = prior, 
                     nitt = c(110000), burnin = 10000, thin = 50, verbose = F)



j_surv_vcv_phylo <- j_surv$VCV[,1]
j_surv_vcv_spec <- j_surv$VCV[,2]
j_surv_vcv_units <- j_surv$VCV[,3]

j_surv_phylo <- j_surv_vcv_phylo/c(j_surv_vcv_phylo + j_surv_vcv_spec + j_surv_vcv_units)
j_surv_spec <- j_surv_vcv_spec/c(j_surv_vcv_phylo + j_surv_vcv_spec + j_surv_vcv_units)
j_surv_units <- j_surv_vcv_units/c(j_surv_vcv_phylo + j_surv_vcv_spec + j_surv_vcv_units)

hdr(j_surv_phylo)
hdr(j_surv_spec)
hdr(j_surv_units)


```





